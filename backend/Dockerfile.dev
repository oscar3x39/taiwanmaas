# ğŸ¤– AI-Optimized Development Dockerfile
# ğŸ“ å°ˆç‚ºé–‹ç™¼ç’°å¢ƒå„ªåŒ–çš„å¾Œç«¯å®¹å™¨
# 
# ğŸš€ é–‹ç™¼ç’°å¢ƒç‰¹è‰²ï¼š
# âœ… ç†±é‡è¼‰å’Œå³æ™‚ç¨‹å¼ç¢¼åŒæ­¥
# âœ… é™¤éŒ¯å·¥å…·å’Œé–‹ç™¼ä¾è³´
# âœ… å¿«é€Ÿå•Ÿå‹•å’Œå¢é‡å»ºæ§‹
# âœ… é–‹ç™¼è€…å‹å–„çš„å·¥å…·éˆ
# âœ… å®‰å…¨æ€§æ›´æ–°å’Œæ•ˆèƒ½å„ªåŒ–

FROM node:20-alpine AS development

# å®‰è£å®‰å…¨æ›´æ–°å’Œé–‹ç™¼å·¥å…·
RUN apk update && apk upgrade && \
    apk add --no-cache \
    python3 \
    make \
    g++ \
    curl \
    git \
    bash \
    vim && \
    rm -rf /var/cache/apk/*

# è¨­å®šå·¥ä½œç›®éŒ„
WORKDIR /app

# è¤‡è£½ package files
COPY package*.json ./

# å®‰è£æ‰€æœ‰ä¾è³´ (åŒ…å«é–‹ç™¼ä¾è³´)
RUN npm ci --include=dev --no-audit && \
    (npm audit fix --force || true)

# è¤‡è£½åŸå§‹ç¢¼ (åœ¨é–‹ç™¼æ¨¡å¼ä¸‹æœƒè¢« volume è¦†è“‹)
COPY . .

# å»ºç«‹å¿…è¦ç›®éŒ„ä¸¦è¨­å®šæ¬Šé™
RUN mkdir -p logs dist && \
    chown -R node:node /app

# è¨­å®šç’°å¢ƒè®Šæ•¸
ENV NODE_ENV=development
ENV DEBUG=*

# åˆ‡æ›åˆ° node ç”¨æˆ¶
USER node

# æš´éœ²ç«¯å£ (3000: æ‡‰ç”¨ç¨‹å¼, 9229: Node.js é™¤éŒ¯)
EXPOSE 3000 9229

# å¥åº·æª¢æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \
  CMD curl -f http://localhost:3000/api/health || exit 1

# é–‹ç™¼æ¨¡å¼å•Ÿå‹•å‘½ä»¤ (æ”¯æ´é™¤éŒ¯)
CMD ["npm", "run", "dev"]